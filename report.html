<!-- Prepared by: Eng. Aisha Alhuwais | ID: 22101186 -->
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Cairo', Tahoma, Arial, sans-serif; background: #f7fafc; margin: 0; padding: 40px;}
    .container { max-width: 1100px; margin: auto; background: #fff; border-radius: 16px; box-shadow: 0 2px 16px #0001; padding: 28px;}
    h1 { color: #002147; margin-bottom: 24px;}
    .filter-btn { background: #e5ebf1; color: #0e223a; border: none; border-radius: 14px; padding: 12px 26px; font-family: 'Cairo'; font-weight: bold; font-size: 1.05em; cursor: pointer; transition: 0.13s;}
    .filter-btn.active, .filter-btn:focus { background: #002147 !important; color: #fff !important;}
    .table-responsive { overflow-x: auto; margin-top: 16px;}
    table { border-collapse: collapse; width: 100%; min-width: 950px;}
    th, td { border: 1px solid #dbeafe; padding: 7px 10px; text-align: center;}
    th { background: #002147; color: #fff;}
    tr:nth-child(even) td { background: #f3f6fa; }
    .search-input { font-family:'Cairo'; padding: 9px 16px; border-radius: 10px; border: 1px solid #d3dce6; min-width: 260px; font-size: 1.15em; text-align: center; box-shadow: 0 2px 6px #0001;}
    @media (max-width: 700px) {.search-input { min-width: 120px; }}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>
<body>
<div class="container">
  <div style="display: flex; align-items: center; justify-content: center; gap: 7px; margin-bottom: 16px;">
    <h1 style="margin:0;font-size:2.1em;color:#14223A;font-weight:900;letter-spacing:1px;">ØªÙ‚Ø±ÙŠØ± Ø¹Ù† Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h1>
  </div>
  <div class="search-group" style="display:flex;flex-direction:column;align-items:center;margin-bottom:18px;">
    <input type="text" id="searchInput" class="search-input" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ø¹Ø©" oninput="renderTable()"/>
  </div>
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;gap:12px;">
    <div class="filter-group" style="display:flex; gap:12px;">
      <button id="allBtn" onclick="filterByBuilding('all')" class="filter-btn active">âœ–</button>
      <button id="northBtn" onclick="filterByBuilding('Ø§Ù„Ø´Ù…Ø§Ù„ÙŠ')" class="filter-btn">Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠ</button>
      <button id="southBtn" onclick="filterByBuilding('Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠ')" class="filter-btn">Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠ</button>
    </div>
  </div>
  <div class="table-responsive" style="overflow-x:auto; width:100%;">
    <table>
      <thead>
        <tr>
          <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th>Ø§Ù„Ù…Ø¨Ù†Ù‰</th>
          <th>Ø§Ù„Ø¯ÙˆØ±</th>
          <th>Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø¹Ø©</th>
          <th>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ø¹Ø©</th>
          <th>Ø§Ù„Ø³Ø¹Ø©</th>
          <th>Ø¨ÙˆØ¯ÙŠÙˆÙ…</th>
          <th>Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</th>
          <th>Ø§Ù„Ø´Ø¨ÙƒØ©</th>
          <th>Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¹Ø±Ø¶</th>
          <th>Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¹Ø±Ø¶</th>
          <th>Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†</th>
          <th>Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© </th>
          <th>Ø§Ù„Ø³ØªØ§Ø¦Ø±</th>
          <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
          <th>ğŸ“</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDqMFfWwtzXInusoxsJxgEO5_ptz_fRk6E",
  authDomain: "itu-coa.firebaseapp.com",
  projectId: "itu-coa",
  storageBucket: "itu-coa.firebasestorage.app",
  messagingSenderId: "790497191019",
  appId: "1:790497191019:web:a5b4de6f65574457503d2e",
  measurementId: "G-D5L66D3QZP"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const collectionName = "classes";
let currentUser = localStorage.getItem("currentUser") || "";
let allowedRoles = JSON.parse(localStorage.getItem("allowedRoles") || "[]");
let allClasses = [];
let currentBuildingFilter = "all";

  function loadTable() {
  db.collection(collectionName).onSnapshot(snapshot => {
    allClasses = [];
    snapshot.forEach(doc => {
      let data = doc.data();
      data.id = doc.id;
      allClasses.push(data);
    });
    renderTable();
  });
}

function renderTable() {
  const tbody = document.getElementById('tableBody');
  const searchTerm = document.getElementById('searchInput').value.trim();
  let filtered = allClasses;
    const normalizedRoles = allowedRoles.map(x => (x || '').replace(/"/g, '').trim());
  if (searchTerm) {
    filtered = filtered.filter(d =>
      (d.no && d.no.toString().includes(searchTerm)) ||
      (d.type && d.type.includes(searchTerm)) ||
      (d.remark && d.remark.includes(searchTerm))
    );
  } else if (currentBuildingFilter !== "all") {
    filtered = filtered.filter(d => (d.building || "").trim() === currentBuildingFilter);
  }
  tbody.innerHTML = "";
  if (filtered.length === 0) {
    tbody.innerHTML = "<tr><td colspan='16'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>";
    return;
  }
  filtered.forEach((d) => {
    const key = `${(d.building||"").trim()}-${(d.floor||"").trim()}`;
    const canEdit = normalizedRoles.includes(key) || currentUser === "admin";
    const editBtn = `<button onclick="editClass('${d.id}')" title="ØªØ¹Ø¯ÙŠÙ„" style="background:none;border:none;cursor:pointer;padding:0;margin:0;font-size:1.2em;">âœï¸</button>`;
    const row = `<tr>
      <td>${d.status || ""}</td>
      <td>${d.building || ""}</td>
      <td>${d.floor || ""}</td>
      <td>${d.type || ""}</td>
      <td>${d.no || ""}</td>
      <td>${d.cap || ""}</td>
      <td>${d.podium || ""}</td>
      <td>${d.pc || ""}</td>
      <td>${d.network || ""}</td>
      <td>${d.proj1 || ""}</td>
      <td>${d.proj2 || ""}</td>
      <td>${d.mic || ""}</td>
      <td>${d.light || ""}</td>
      <td>${d.curtain || ""}</td>
      <td>${d.remark || ""}</td>
      <td>${canEdit ? editBtn : ""}</td>
    </tr>`;
    tbody.innerHTML += row;
  });
}

function filterByBuilding(building) {
  currentBuildingFilter = building;
  document.getElementById("northBtn").classList.remove("active");
  document.getElementById("southBtn").classList.remove("active");
  document.getElementById("allBtn").classList.remove("active");
  if (building === "Ø§Ù„Ø´Ù…Ø§Ù„ÙŠ") document.getElementById("northBtn").classList.add("active");
  else if (building === "Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠ") document.getElementById("southBtn").classList.add("active");
  else document.getElementById("allBtn").classList.add("active");
  renderTable();
}

function showLogin() {
  Swal.fire({
    title: 'ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙØ±ÙŠÙ‚',
    html: `<input id="swal-username" class="swal2-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
           <input id="swal-password" type="password" class="swal2-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">`,
    confirmButtonText: 'Ø¯Ø®ÙˆÙ„',
    showCancelButton: true,
    preConfirm: async () => {
      const username = document.getElementById('swal-username').value.trim();
      const password = document.getElementById('swal-password').value;
      if (!username || !password) {
        Swal.showValidationMessage('Ø£Ø¯Ø®Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        return false;
      }
      const querySnapshot = await db.collection("it_team")
        .where("username", "==", username)
        .where("password", "==", password)
        .get();
      if (!querySnapshot.empty) {
        currentUser = username;
        localStorage.setItem("currentUser", currentUser);
        let userData = querySnapshot.docs[0].data();
        allowedRoles = userData.roles || [];
        localStorage.setItem("allowedRoles", JSON.stringify(allowedRoles));
        console.log("âœ”ï¸ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ØµØ­ÙŠØ­", currentUser, allowedRoles);
        return true;
      } else {
        Swal.showValidationMessage('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
        return false;
      }
    }
  }).then((result) => {
    if (result.isConfirmed) {
      Swal.fire({
        title: 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!',
        icon: 'success'
      }).then(() => location.reload());
    }
  });
}

  function toggleLock() {
  if (!isLocked) {
    isLocked = true;
    document.getElementById("addClassBtn").setAttribute("disabled", "true");
    document.getElementById("lockIcon").textContent = "ğŸ”’";
  } else {
    Swal.fire({
      title: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Admin)',
      html: `<input id="swal-username" class="swal2-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
             <input id="swal-password" type="password" class="swal2-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">`,
      confirmButtonText: 'Ø¯Ø®ÙˆÙ„',
      showCancelButton: true,
      preConfirm: () => {
        const username = document.getElementById('swal-username').value;
        const password = document.getElementById('swal-password').value;
        if (!username || !password) {
          Swal.showValidationMessage('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
          return false;
        }
        return { username, password };
      }
    }).then(async (result) => {
      if (result.isConfirmed && result.value) {
        const q = await db.collection("admin_users")
          .where("username", "==", result.value.username)
          .where("password", "==", result.value.password)
          .get();
        if (!q.empty) {
          isLocked = false;
          document.getElementById("addClassBtn").removeAttribute("disabled");
          document.getElementById("lockIcon").textContent = "ğŸ”“";
          Swal.fire('ØªÙ… ÙØªØ­ Ø§Ù„Ù‚ÙÙ„!', '', 'success');
        } else {
          Swal.fire('Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
        }
      }
    });
  }
}
function addClassFlow() {
  openAddSwal();
}
function openAddSwal() {
  Swal.fire({
    title: `<div style="font-weight:900; font-size:1.3em; color:#1a3765; margin-bottom:5px; letter-spacing:1px;">â• Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ø¹Ø© Ø¯Ø±Ø§Ø³ÙŠØ©</div>`,
    width: 900,
    customClass: { popup: 'swal-wide-modal' },
    html: `
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div>
          <label style="font-weight:700;">Ø§Ù„Ø­Ø§Ù„Ø©</label>
          <select id="swal-status" class="swal2-input" style="width:100%;">
            <option>ğŸŸ¢</option>
            <option>ğŸ”´</option>
            <option>ğŸŸ¡</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700;">Ø§Ù„Ù…Ø¨Ù†Ù‰</label>
          <select id="swal-building" class="swal2-input" style="width:100%;">
            <option>Ø§Ù„Ø´Ù…Ø§Ù„ÙŠ</option>
            <option>Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠ</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700;">Ø§Ù„Ø¯ÙˆØ±</label>
          <select id="swal-floor" class="swal2-input" style="width:100%;">
            <option>G</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700;">Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø¹Ø©</label>
          <select id="swal-type" class="swal2-input" style="width:100%;">
            <option>ÙØµÙ„ Ø¯Ø±Ø§Ø³ÙŠ</option>
            <option>ØºØ±ÙØ© ØªØ¯Ø±ÙŠØ¨</option>
            <option>ØºØ±ÙØ© Ø¥Ø¬ØªÙ…Ø§Ø¹Ø§Øª</option>
            <option>Ù‚Ø§Ø¹Ø© Ø¹Ø±Ø¶</option>
            <option>Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù„ØºØ§Øª</option>
            <option>Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø­Ø§Ø³ÙˆØ¨</option>
            <option>ØªØ¯Ø±ÙŠØ¨ Ù…Ø³Ø±Ø­ÙŠ</option>
            <option>Ù…Ø®ØªØ¨Ø± Ø§Ù„ØªØµÙˆÙŠØ± Ø§Ù„ØµØ­ÙÙŠ</option>
            <option>Ù…Ø®ØªØ¨Ø± Ø§Ù„ØªØ­Ø±ÙŠØ±</option>
            <option>Ø¥Ù†ØªØ§Ø¬ Ø§Ù„ØµØ­Ù</option>
            <option>Ù…Ø®ØªØ¨Ø± ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</option>
            <option>Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø¯Ø¹Ø§ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†</option>
            <option>Ù…Ø®ØªØ¨Ø± Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©</option>
            <option>Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ Ø§Ù„Ø¥Ø°Ø§Ø¹ÙŠ</option>
            <option>Ø§Ù„Ù…Ø³Ø±Ø­ Ø§Ù„Ø£Ø³ÙˆØ¯</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700;">Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ø¹Ø©</label>
          <input id="swal-no" class="swal2-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ø¹Ø©" required>
        </div>
        <div>
          <label style="font-weight:700;">Ø§Ù„Ø³Ø¹Ø©</label>
          <input id="swal-cap" class="swal2-input" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯" required>
        </div>
        <div>
          <label style="font-weight:700;">Ø¨ÙˆØ¯ÙŠÙˆÙ…</label>
          <select id="swal-podium" class="swal2-input" style="width:100%;">
            <option>Ø´ØºØ§Ù„</option>
            <option>Ù‚ÙŠØ¯ Ø§Ù„ØµÙŠØ§Ù†Ø©</option>
            <option>ØºÙŠØ± Ø´ØºØ§Ù„</option>
            <option>-</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700;">Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</label>
          <select id="swal-pc" class="swal2-input" style="width:100%;">
            <option>Ø´ØºØ§Ù„</option>
            <option>Ù‚ÙŠØ¯ Ø§Ù„ØµÙŠØ§Ù†Ø©</option>
            <option>ØºÙŠØ± Ø´ØºØ§Ù„</option>
            <option>-</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700;">Ø§Ù„Ø´Ø¨ÙƒØ©</label>
          <select id="swal-network" class="swal2-input" style="width:100%;">
            <option>Ù…ØªØµÙ„</option>
            <option>ØºÙŠØ± Ù…ØªØµÙ„</option>
            <option>-</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700;">Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¹Ø±Ø¶</label>
          <select id="swal-proj1" class="swal2-input" style="width:100%;">
            <option>Ø´ØºØ§Ù„</option>
            <option>Ù‚ÙŠØ¯ Ø§Ù„ØµÙŠØ§Ù†Ø©</option>
            <option>ØºÙŠØ± Ø´ØºØ§Ù„</option>
            <option>-</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700;">Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¹Ø±Ø¶</label>
          <select id="swal-proj2" class="swal2-input" style="width:100%;">
            <option>Ø´ØºØ§Ù„</option>
            <option>Ù‚ÙŠØ¯ Ø§Ù„ØµÙŠØ§Ù†Ø©</option>
            <option>ØºÙŠØ± Ø´ØºØ§Ù„</option>
            <option>-</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700;">Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†</label>
          <select id="swal-mic" class="swal2-input" style="width:100%;">
            <option>Ø´ØºØ§Ù„</option>
            <option>Ù‚ÙŠØ¯ Ø§Ù„ØµÙŠØ§Ù†Ø©</option>
            <option>ØºÙŠØ± Ø´ØºØ§Ù„</option>
            <option>-</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700;">Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø©</label>
          <select id="swal-light" class="swal2-input" style="width:100%;">
            <option>Ø´ØºØ§Ù„</option>
            <option>Ù‚ÙŠØ¯ Ø§Ù„ØµÙŠØ§Ù†Ø©</option>
            <option>ØºÙŠØ± Ø´ØºØ§Ù„</option>
            <option>-</option>
          </select>
        </div>
        <div>
          <label style="font-weight:700;">Ø§Ù„Ø³ØªØ§Ø¦Ø±</label>
          <select id="swal-curtain" class="swal2-input" style="width:100%;">
            <option>Ø´ØºØ§Ù„</option>
            <option>Ù‚ÙŠØ¯ Ø§Ù„ØµÙŠØ§Ù†Ø©</option>
            <option>ØºÙŠØ± Ø´ØºØ§Ù„</option>
            <option>-</option>
          </select>
        </div>
        <div style="grid-column:1/-1;">
          <label style="font-weight:700;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
          <textarea id="swal-remark" class="swal2-textarea"
            placeholder="Ø§ÙƒØªØ¨ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ù†Ø§"
            style="width:80%;min-height:34px;max-height:100px;resize:vertical;text-align:right;"></textarea>
        </div>
      </div>`,
    confirmButtonText: 'Ø¥Ø¶Ø§ÙØ©',
    showCancelButton: true,
    cancelButtonText: "Ø¥Ù„ØºØ§Ø¡",
    preConfirm: () => {
      const get = id => document.getElementById(id).value;
      if (!get('swal-no') || !get('swal-cap')) {
        Swal.showValidationMessage('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ø¹Ø© ÙˆØ§Ù„Ø³Ø¹Ø©');
        return false;
      }
      return {
        status: get('swal-status'),
        building: get('swal-building'),
        floor: get('swal-floor'),
        type: get('swal-type'),
        no: get('swal-no'),
        cap: get('swal-cap'),
        podium: get('swal-podium'),
        pc: get('swal-pc'),
        network: get('swal-network'),
        proj1: get('swal-proj1'),
        proj2: get('swal-proj2'),
        mic: get('swal-mic'),
        light: get('swal-light'),
        curtain: get('swal-curtain'),
        remark: get('swal-remark')
      };
    }
  }).then((result) => {
    if (result.isConfirmed && result.value) {
      db.collection("classes").add({
        ...result.value,
        last_edited_by: currentUser || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
        last_edited_at: new Date().toISOString()
      })
      .then(() => {
        Swal.fire('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©!', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØµÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        loadTable();
      })
      .catch(() => {
        Swal.fire('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø¶Ø§ÙØ©!', 'error');
      });
    }
  });
}


function editClass(id) {
    alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');

}

document.addEventListener("DOMContentLoaded", function() {
  let storedUser = localStorage.getItem("currentUser");
  if (storedUser) {
    db.collection("it_team")
      .where("username", "==", storedUser.trim())
      .get()
      .then(snapshot => {
        if (!snapshot.empty) {
          let userData = snapshot.docs[0].data();
          allowedRoles = userData.roles || [];
          localStorage.setItem("allowedRoles", JSON.stringify(allowedRoles));
          currentUser = storedUser;
          console.log("âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ allowedRoles:", allowedRoles);
          loadTable();
        } else {
          allowedRoles = [];
          localStorage.setItem("allowedRoles", JSON.stringify([]));
          currentUser = "";
          console.warn("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… - ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
          showLogin();
        }
      });
  } else {
    allowedRoles = [];
    localStorage.setItem("allowedRoles", JSON.stringify([]));
    currentUser = "";
    showLogin();
  }
});
</script>
</body>
</html>
